<div class="container" data-controller="conversation-trigger">
  <div class="row m-3">
    <div class="col-sm-4">
      <% @chatrooms.each do |chatroom| %>
        <%= link_to chatroom_path(chatroom), class: "chat-text-deco" do %>

          <% if current_user.id == chatroom.host_id  %>
            <div class="card m-3 borders p-2" id="chat-<%=chatroom.id%>"  data-action="click->conversation-trigger#render">
              <div class="row g-0">
                <div class="col-sm-3 d-flex align-items-center">
                  <% if User.find(chatroom.guest_id).picture.attached? %>
                    <%= cl_image_tag User.find(chatroom.guest_id).picture.key, class:"message-user-pic" %>
                  <% else %>
                    <%= image_tag "userPlaceholder.png", class:"message-user-pic" %>
                  <% end %>
                </div>
                <div class="col-sm-9">
                  <div class="card-body">
                    <div class="card-text">
                      <p class="m-1"><%= chatroom.messages.last.content %></p>
                      <p hidden data-conversation-trigger-target="chatsId" > <%= chatroom.id %></p>
                      <i><%= (Time.now - chatroom.messages.last.created_at).round/60%> mins ago.</i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% elsif current_user.id == chatroom.guest_id %>
            <div class="card m-3 borders p-2">
              <div class="row g-0">
                <div class="col-sm-3 d-flex align-items-center">
                  <% if User.find(chatroom.host_id).picture.attached? %>
                    <%= cl_image_tag User.find(chatroom.host_id).picture.key, class:"message-user-pic" %>
                  <% else %>
                    <%= image_tag "userPlaceholder.png", class:"message-user-pic" %>
                  <% end %>
                </div>
                <div class="col-sm-9">
                  <div class="card-body">
                    <div class="card-text">
                      <p class="m-1"><%= chatroom.messages.last.content %></p>
                      <i><%= (Time.now - chatroom.messages.last.created_at).round/60%> mins ago.</i>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          <% end %>
        <% end %>
      <% end %>
    </div>
    <div class="col-sm-1 vl"></div>
    <div class="col-sm-7">
      <% if @chatroom.present? %>
        <div class="container shadows mt-5" data-controller="chatroom-subscription" data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>">
          <div class="messages chat-box" data-chatroom-subscription-target="messages">
            <% @chatroom.messages.each do |message| %>
                <%= render "messages/message", message: message %>
            <% end %>
          </div>
          <%= simple_form_for [@chatroom, @message], html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f| %>
            <%= f.input :content,
              label: false,
              placeholder: "Message ##{@chatroom.name}",
              wrapper_html: {class: "flex-grow-1"}
            %>
            <%= f.submit "Send", class: "btn btn-primary mb-3" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
